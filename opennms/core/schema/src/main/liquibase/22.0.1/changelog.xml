<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd" >

  <changeSet author="cpape" id="22.0.1-has-flows">
    <addColumn tableName="node">
      <column name="hasflows" type="boolean" defaultValue="false" />
    </addColumn>
    <addNotNullConstraint tableName="node" columnName="hasflows"/>

    <addColumn tableName="snmpinterface">
      <column name="hasflows" type="boolean" defaultValue="false"/>
    </addColumn>
    <addNotNullConstraint tableName="snmpinterface" columnName="hasflows"/>
  </changeSet>

  <changeSet author="ndarbha" id="22.0.1-kdpelement">
    <validCheckSum>ANY</validCheckSum>

    <createTable tableName="kdpelement">
      <column name="id" type="integer" defaultValueComputed="nextval('opennmsNxtId')">
        <constraints primaryKey="true" primaryKeyName="pk_kdpelement_id" nullable="false" />
      </column>
      <column name="nodeid" type="integer">
        <constraints nullable="false" />
      </column>
      <column name="kdpnodecreatetime" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="kdpnodelastpolltime" type="DATETIME">
        <constraints nullable="false" />
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="fk_kdpelement_nodeid" onDelete="CASCADE" baseTableName="kdpelement" baseColumnNames="nodeid" referencedTableName="node" referencedColumnNames="nodeid" />
    <createIndex tableName="kdpelement" indexName="kdpelement_nodeid_idx">
      <column name="nodeid" />
    </createIndex>

    <rollback>
      <dropTable tableName="kdpelement" />
    </rollback>

  </changeSet>

  <changeSet author="ndarbha" id="22.0.1-kdplink">
    <validCheckSum>ANY</validCheckSum>

    <createTable tableName="kdplink">
      <column name="id" type="integer" defaultValueComputed="nextval('opennmsNxtId')">
        <constraints primaryKey="true" primaryKeyName="pk_kdplink_id" nullable="false" />
      </column>
      <column name="nodeid" type="integer">
        <constraints nullable="false" />
      </column>
      <column name="kdpinterfacename" type="text">
        <constraints nullable="false" />
      </column>
      <column name="kdplinkcreatetime" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="kdplinklastpolltime" type="DATETIME">
        <constraints nullable="false" />
      </column>
      <column name="kdplinkmacaddress" type="varchar(20)">
        <constraints nullable="true" />
      </column>
      <column name="kdplinkremoteaddress" type="varchar(20)">
        <constraints nullable="true" />
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="fk_kdplink_nodeid" onDelete="CASCADE" baseTableName="kdplink" baseColumnNames="nodeid" referencedTableName="node" referencedColumnNames="nodeid" />
    <createIndex tableName="kdplink" indexName="kdplink_nodeid_idx">
      <column name="nodeid" />
    </createIndex>

    <rollback>
      <dropTable tableName="kdplink" />
    </rollback>

  </changeSet>

  <changeSet author="ndarbha" id="22.0.1-nodeinfo">
    <validCheckSum>ANY</validCheckSum>

    <createTable tableName="nodeinfo">
      <column name="id" type="integer" defaultValueComputed="nextval('opennmsNxtId')">
        <constraints primaryKey="true" primaryKeyName="pk_nodeinfo_id" nullable="false" />
      </column>
      <column name="nodeid" type="integer">
        <constraints nullable="false" />
      </column>
      <column name="macaddress" type="varchar(20)">
        <constraints nullable="false" />
      </column>
      <column name="serialnumber" type="varchar(30)">
        <constraints nullable="true" />
      </column>
      <column name="model" type="varchar(30)">
        <constraints nullable="true" />
      </column>
      <column name="firmware" type="varchar(30)">
        <constraints nullable="true" />
      </column>
      <column name="ipaddress" type="varchar(30)">
        <constraints nullable="true" />
      </column>
      <column name="systemname" type="varchar(30)">
        <constraints nullable="true" />
      </column>
      <column name="frequencychannel" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="bandwidth" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="ethernetspeed" type="varchar(5)">
        <constraints nullable="true" />
      </column>
      <column name="iobandwidthlimit" type="varchar(5)">
        <constraints nullable="true" />
      </column>
      <column name="modulation" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="opmode" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="provisioned" type="boolean" defaultValue="false">
        <constraints nullable="false" />
      </column>
      <column name="active" type="boolean" defaultValue="true">
        <constraints nullable="false" />
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="fk_nodeinfo_nodeid" onDelete="CASCADE" baseTableName="nodeinfo" baseColumnNames="nodeid" referencedTableName="node" referencedColumnNames="nodeid" />
    <createIndex tableName="nodeinfo" indexName="nodeinfo_nodeid_idx">
      <column name="nodeid" />
    </createIndex>

    <rollback>
      <dropTable tableName="nodeinfo" />
    </rollback>

  </changeSet>


  <changeSet author="ndarbha" id="22.0.1-ethernetstats">
    <validCheckSum>ANY</validCheckSum>

    <createTable tableName="ethernetstats">
      <column name="id" type="integer" defaultValueComputed="nextval('opennmsNxtId')">
        <constraints primaryKey="true" primaryKeyName="pk_ethernetstats_id" nullable="false" />
      </column>
      <column name="nodeid" type="integer">
        <constraints nullable="false" />
      </column>
      <column name="txpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="rxpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="txbytes" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="rxbytes" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="txerrors" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="rxerrors" type="integer">
        <constraints nullable="true" />
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="fk_ethernetstats_nodeid" onDelete="CASCADE" baseTableName="ethernetstats" baseColumnNames="nodeid" referencedTableName="node" referencedColumnNames="nodeid" />
    <createIndex tableName="ethernetstats" indexName="ethernetstats_nodeid_idx">
      <column name="nodeid" />
    </createIndex>

    <rollback>
      <dropTable tableName="ethernetstats" />
    </rollback>

  </changeSet>

  <changeSet author="ndarbha" id="22.0.1-wirelessstats">
    <validCheckSum>ANY</validCheckSum>

    <createTable tableName="wirelessstats">
      <column name="id" type="integer" defaultValueComputed="nextval('opennmsNxtId')">
        <constraints primaryKey="true" primaryKeyName="pk_wirelessstats_id" nullable="false" />
      </column>
      <column name="nodeid" type="integer">
        <constraints nullable="false" />
      </column>
      <column name="txpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="rxpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="txmgmtpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="rxmgmtpackets" type="bigint">
        <constraints nullable="true" />
      </column>
      <column name="mpduerrors" type="integer">
        <constraints nullable="true" />
      </column>
      <column name="physicalerrors" type="integer">
        <constraints nullable="true" />
      </column>
    </createTable>

    <addForeignKeyConstraint constraintName="fk_wirelessstats_nodeid" onDelete="CASCADE" baseTableName="wirelessstats" baseColumnNames="nodeid" referencedTableName="node" referencedColumnNames="nodeid" />
    <createIndex tableName="wirelessstats" indexName="wirelessstats_nodeid_idx">
      <column name="nodeid" />
    </createIndex>

    <rollback>
      <dropTable tableName="wirelessstats" />
    </rollback>

  </changeSet>

</databaseChangeLog>
